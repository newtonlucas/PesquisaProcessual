
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Pesquisa de Processos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="CSS/pp.css">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card text-center">
                    <div class="card-header">
                        <h4>Pesquisa de Processos no TJSP</h4>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">Acesso Restrito</h5>
                        <p class="card-text">Por favor, faça login com sua conta Microsoft para continuar.</p>
                        
                        <!-- O link aponta para a rota /login do seu backend -->
                        <a href="https://pesquisa-c4hmaugwe4dfbjgw.brazilsouth-01.azurewebsites.net/login" class="btn btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-microsoft" viewBox="0 0 16 16">
                                <path d="M7.462 0H0v7.462h7.462V0zM16 0H8.538v7.462H16V0zM7.462 8.538H0V16h7.462V8.538zM16 8.538H8.538V16H16V8.538z"/>
                            </svg>
                            Login com Microsoft
                        </a>
                    </div>
                    <div class="card-footer text-muted">
                        Você será redirecionado para a página de login da Microsoft.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // URL do backend
        const API_URL = 'https://pesquisa-c4hmaugwe4dfbjgw.brazilsouth-01.azurewebsites.net';

        (async function () {
            try {
                // Verifica se o usuário já tem uma sessão ativa no backend
                const response = await fetch(`${API_URL}/api/me`, {
                    credentials: 'include' // Importante para enviar o cookie de sessão
                });

                if (response.ok) {
                    // Se a resposta for OK (200), o usuário está logado.
                    // Redireciona para a página principal de pesquisa.
                    window.location.href = 'resultados.html';
                }
                // Se a resposta for 401 ou outra, o usuário não está logado,
                // então a página de login continua sendo exibida.

            } catch (error) {
                console.error('Não foi possível verificar o status de login:', error);
                // Mantém na página de login em caso de erro de rede, etc.
            }
        })();
    </script>
</body>
</html>
